<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- 1. SEO E METADADOS -->
    <title>{{ title }} | ChefBrico</title>
    <meta name="description" content="{{ description }}">
    <meta name="author" content="Maria Concei√ß√£o">
    <meta name="theme-color" content="#014039">
    
    <!-- 2. SINALIZA√á√ÉO PARA AGENTES DE IA (A-COMMERCE) -->
    <link rel="llms-txt" href="/llms.txt">
    <link rel="author" href="https://gourmetpratico.com.br/comida-de-verdade/">
    
    <!-- 3. SEO T√âCNICO & SOCIAL -->
    <link rel="canonical" href="https://gourmetpratico.com.br{{ page.url }}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://gourmetpratico.com.br{{ page.url }}">
    <meta property="og:title" content="{{ title }}">
    <meta property="og:description" content="{{ description }}">
    
    {% if image %}
    <meta property="og:image" content="https://gourmetpratico.com.br{{ image }}">
    {% else %}
    <meta property="og:image" content="https://gourmetpratico.com.br/imagens/share-padrao-chefbrico.png">
    {% endif %}

    <!-- 4. ESTILOS (CSS) -->
    <link rel="stylesheet" href="/css/style.css">
    
    <!-- CSS CR√çTICO DA GAMIFICA√á√ÉO (Para evitar Layout Shift) -->
    <style>
        .chefbox-sticky-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: white; border-top: 4px solid #F2811D;
            padding: 15px 0; z-index: 999;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; align-items: center;
            transition: transform 0.3s ease;
        }
        .slots-wrapper {
            display: flex; gap: 10px; justify-content: center; width: 100%;
        }
        .slot-circle {
            width: 40px; height: 40px; border-radius: 50%;
            background: #eee; color: #999; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid #ddd; transition: all 0.3s;
        }
        .slot-circle.filled {
            background: #014039; color: white; border-color: #014039;
        }
        .slot-circle.gift {
            background: #F2811D; color: white; border-color: #F2811D; font-size: 1.2rem;
        }
        .btn-finish-float {
            background: #25D366; color: white; border: none;
            padding: 12px 30px; border-radius: 50px; font-weight: bold;
            margin-top: 10px; cursor: pointer; animation: pulse 2s infinite;
            display: none; /* Ativado via JS */
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>

    <!-- 5. CMS & ANALYTICS -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

    <!-- 6. SCHEMA.ORG (JSON-LD) -->
    {% if schema %}
    <script type="application/ld+json">
        {{ schema | dump | safe }}
    </script>
    {% endif %}
</head>
<body>
    
    <!-- A. CABE√áALHO -->
    {% include "header.njk" %}
    
    <!-- B. CONTE√öDO PRINCIPAL -->
    <main>
        {{ content | safe }}
    </main>
    
    <!-- C. RODAP√â -->
    {% include "footer.njk" %}
    
    <!-- ======================================================= -->
    <!-- D. R√âGUA DE GAMIFICA√á√ÉO (CHEFBOX 4+1)                   -->
    <!-- ======================================================= -->
    {% if '/receitas/' in page.url or '/chefbox/' in page.url %}
    <div id="chefbox-bar" class="chefbox-sticky-bar">
        <div class="bar-info" style="margin-bottom: 5px; font-size: 0.9rem; color: #555;">
            <span id="game-status-text">Monte sua ChefBox (Faltam 5):</span>
        </div>
        
        <div class="slots-wrapper">
            <div id="slot-1" class="slot-circle">1</div>
            <div id="slot-2" class="slot-circle">2</div>
            <div id="slot-3" class="slot-circle">3</div>
            <div id="slot-4" class="slot-circle">4</div>
            <div id="slot-5" class="slot-circle gift" title="Seu Presente!">üéÅ</div>
        </div>

        <button id="btn-finish-game" class="btn-finish-float" onclick="openCheckoutModal()">
            Finalizar Pedido (Ganhar Presente) ‚ûú
        </button>
    </div>
    {% endif %}

   <!-- ======================================================= -->
    <!-- E. MODAL DE CHECKOUT (A-COMMERCE)                       -->
    <!-- ======================================================= -->
    <div id="checkout-modal" class="modal-overlay" style="display: none;">
        <div class="modal-box">
            <h3>Quase l√°! ü•ó</h3>
            <p style="margin-bottom:15px; font-size:0.9rem; color:#666;">
                Preencha para gerar seu pedido no WhatsApp.
            </p>
            
            <form name="pedido_chefbox" method="POST" data-netlify="true" id="form-checkout">
                <input type="text" name="nome" id="customer-name" placeholder="Nome Completo" required class="input-field">
                <input type="tel" name="whatsapp" id="customer-phone" placeholder="WhatsApp (DDD + N√∫mero)" required class="input-field">
                
                <div style="display:flex; gap:10px;">
                    <input type="text" name="cep" id="customer-cep" placeholder="CEP (DF)" required class="input-field" style="width: 40%;">
                    <input type="text" id="frete-preview" value="Frete Gr√°tis (DF)" disabled class="input-field" style="width: 60%; background:#e8f5e9; color:#2e7d32; font-weight:bold;">
                </div>

                <textarea name="endereco" id="customer-address" rows="2" placeholder="Endere√ßo de Entrega" required class="input-field"></textarea>
                
                <!-- Campos Ocultos (Preenchidos pelo JS) -->
                <input type="hidden" name="pedido_resumo" id="hidden-pedido">
                <input type="hidden" name="total_valor" id="hidden-total">

                <button type="submit" class="btn-finalizar-zap">
                    <span>ENVIAR PEDIDO NO WHATSAPP</span>
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.008-.57-.008-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></path></svg>
                </button>
                
                <p onclick="closeCheckoutModal()" style="text-align: center; margin-top: 15px; color: #999; cursor: pointer; text-decoration: underline;">Voltar / Alterar Itens</p>
            </form>
        </div>
    </div>
    
    <!-- F. SCRIPTS -->
    <script>
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", user => {
          if (!user) {
            window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; });
          }
        });
      }
    </script>
    <script src="/js/app.js"></script>

</body>
</html>
